

## 3. 基本設計書

### 3.1 システム概要
「いもかつ」Webアプリケーションは、Spring MVCアーキテクチャを採用し、フロントエンドとバックエンドで構成されます。フロントエンドはThymeleafテンプレートエンジンとJavaScript/jQueryを使用し、バックエンドはJava/Spring Frameworkで実装します。データはPostgreSQLデータベースに保存されます。

### 3.2 アーキテクチャ設計

#### 3.2.1 全体アーキテクチャ
- フロントエンド：HTML5, CSS3, JavaScript, jQuery, Bootstrap
- テンプレートエンジン：Thymeleaf
- バックエンド：Java 17, Spring Boot 3.x, Spring MVC, Spring Data JPA
- データベース：PostgreSQL 14+
- セキュリティ：Spring Security
- ファイルストレージ：Amazon S3またはローカルファイルシステム
- 認証：Spring Security, OAuth2.0
- マップAPI：Google Maps API または Leaflet + OpenStreetMap
- 監視・ログ：Spring Actuator, Logback, ELK Stack

#### 3.2.2 レイヤー構造
1. **プレゼンテーション層**
   - Webコントローラー
   - ビューテンプレート
   - REST API
   - エラーハンドリング

2. **ビジネスロジック層**
   - サービスクラス
   - ドメインモデル
   - バリデーション
   - トランザクション管理

3. **データアクセス層**
   - リポジトリインターフェース
   - ORM（Hibernateによる実装）
   - ネイティブSQLクエリ
   - キャッシュ管理

4. **インフラストラクチャ層**
   - データベース接続管理
   - 外部サービス連携
   - セキュリティ設定
   - ファイル管理

### 3.3 機能モジュール設計

#### 3.3.1 認証モジュール
- ユーザー登録・ログイン
- OAuth2.0連携
- セッション管理
- 権限管理
- パスワードリセット

#### 3.3.2 イモムシ管理モジュール
- イモムシ登録
- 図鑑管理
- 検索・フィルター
- メタデータ処理
- 画像管理

#### 3.3.3 位置情報モジュール
- 位置データ処理
- マップ表示管理
- 位置履歴管理
- ジオコーディング
- プライバシー制御

#### 3.3.4 コミュニティモジュール
- 投稿管理
- いいね・コメント
- フォロー関係
- フィード生成
- モデレーション

#### 3.3.5 ゲーミフィケーションモジュール
- レベル・経験値管理
- バッジ・実績システム
- イベント管理
- ランキング
- チャレンジ管理

#### 3.3.6 通知モジュール
- 通知生成
- 通知設定管理
- 通知履歴
- メール通知

### 3.4 データ設計基本方針

#### 3.4.1 データモデル概要
- ユーザーエンティティ
- イモムシエンティティ
- 発見記録エンティティ
- コミュニティエンティティ
- 設定・環境エンティティ

#### 3.4.2 データフロー基本設計
- ユーザー登録・認証フロー
- イモムシ登録・更新フロー
- コミュニティ活動フロー
- 通知生成・配信フロー
- イベント参加・進捗フロー

### 3.5 インターフェース設計

#### 3.5.1 UI基本方針
- レスポンシブデザイン
- Bootstrap 5フレームワークの活用
- アクセシビリティ対応
- 直感的なナビゲーション
- モバイルファーストアプローチ

#### 3.5.2 外部システム連携
- GoogleやFacebookのOAuth認証
- マップAPIとの連携
- メール送信サービス連携
- クラウドストレージ連携
- アナリティクス連携

### 3.6 セキュリティ設計

#### 3.6.1 認証・認可方式
- Spring Securityを活用したフォームベース認証
- JWTトークンによるAPI認証
- ロールベースのアクセス制御
- OAuth2.0によるSNS認証連携

#### 3.6.2 データ保護
- パスワードのハッシュ化（BCrypt）
- センシティブデータの暗号化
- TLS/SSL通信
- CSRFトークン保護
- XSS対策

### 3.7 非機能設計

#### 3.7.1 パフォーマンス設計
- データベースインデックス最適化
- キャッシュ戦略（Spring Cache）
- 画像の最適化
- 遅延ロード
- クエリ最適化

#### 3.7.2 可用性設計
- エラーハンドリング
- グレースフルデグラデーション
- ヘルスチェック
- リトライメカニズム
- バックアップ戦略

